<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表情包裁剪工具</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>表情包裁剪工具</h1>

        <div class="main-content">
            <!-- 左侧控制面板 -->
            <div class="panel">
                <h2>图片导入</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">点击或拖拽图片到这里<br>支持 JPG、PNG 格式</div>
                </div>
                <input type="file" id="fileInput" accept="image/jpeg,image/png,image/gif,image/webp">

                <div class="image-info hidden" id="imageInfo">
                    <p><strong>文件名:</strong> <span id="fileName">-</span></p>
                    <p><strong>尺寸:</strong> <span id="imageSize">-</span></p>
                    <p><strong>单元格:</strong> <span id="cellSize">-</span></p>
                </div>

                <h2>裁剪模式</h2>
                <div class="mode-switch">
                    <button class="mode-btn active" id="modeUniform" data-mode="uniform">均匀网格</button>
                    <button class="mode-btn" id="modeCenterLine" data-mode="centerline">中心线模式</button>
                </div>
                <p class="mode-hint" id="modeHint">自动将图片等分为网格</p>

                <h2>网格设置</h2>
                <div class="quick-grids">
                    <button class="quick-grid-btn" data-rows="2" data-cols="2">2×2</button>
                    <button class="quick-grid-btn" data-rows="3" data-cols="3">3×3</button>
                    <button class="quick-grid-btn" data-rows="4" data-cols="4">4×4</button>
                    <button class="quick-grid-btn" data-rows="4" data-cols="6">4×6</button>
                    <button class="quick-grid-btn active" data-rows="6" data-cols="4">6×4</button>
                    <button class="quick-grid-btn" data-rows="5" data-cols="5">5×5</button>
                </div>

                <div class="control-group">
                    <label>行数</label>
                    <div class="control-row">
                        <input type="range" id="rowsRange" min="1" max="12" value="6">
                        <input type="number" id="rowsInput" min="1" max="20" value="6">
                    </div>
                </div>

                <div class="control-group">
                    <label>列数</label>
                    <div class="control-row">
                        <input type="range" id="colsRange" min="1" max="12" value="4">
                        <input type="number" id="colsInput" min="1" max="20" value="4">
                    </div>
                </div>

                <div class="control-group centerline-only hidden" id="cellSizeControl">
                    <label>单元格尺寸 (从中心向外扩展)</label>
                    <div class="control-row">
                        <span>宽:</span>
                        <input type="number" id="cellWidth" min="10" value="100">
                        <span>高:</span>
                        <input type="number" id="cellHeight" min="10" value="100">
                    </div>
                    <button class="btn btn-small" id="autoCalcSize">自动计算最优尺寸</button>
                </div>

                <h2>网格样式</h2>
                <div class="control-group">
                    <label>线条颜色</label>
                    <div class="control-row">
                        <input type="color" id="gridColor" value="#ff0000">
                        <span class="value-display" id="colorValue">#ff0000</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>线条粗细</label>
                    <div class="control-row">
                        <input type="range" id="lineWidth" min="1" max="10" value="2">
                        <span class="value-display" id="lineWidthValue">2px</span>
                    </div>
                </div>

                <button class="btn btn-secondary" id="resetLines">重置中心线位置</button>
            </div>

            <!-- 中间画布区域 -->
            <div class="panel panel-main">
                <h2>编辑区域 <span class="hint" id="editHint"></span></h2>
                <div class="canvas-container" id="canvasContainer">
                    <div class="canvas-placeholder" id="placeholder">
                        <div class="icon">🖼️</div>
                        <p>请先导入图片</p>
                    </div>
                    <canvas id="mainCanvas" class="hidden"></canvas>
                </div>
            </div>

            <!-- 右侧预览和导出面板 -->
            <div class="panel">
                <h2>导出设置</h2>
                <div class="control-group">
                    <label>文件名前缀</label>
                    <input type="text" id="filePrefix" value="emoji" placeholder="文件名前缀">
                </div>

                <div class="control-group">
                    <label>导出格式</label>
                    <select id="exportFormat">
                        <option value="png">PNG (推荐，支持透明)</option>
                        <option value="jpeg">JPEG (体积更小)</option>
                        <option value="webp">WebP (现代格式)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>图片质量 (JPEG/WebP)</label>
                    <div class="control-row">
                        <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.9">
                        <span class="value-display" id="qualityValue">90%</span>
                    </div>
                </div>

                <button class="btn btn-primary" id="exportBtn" disabled>
                    📦 导出为 ZIP 压缩包
                </button>
                <button class="btn btn-secondary" id="exportSingleBtn" disabled>
                    💾 分别下载每张图片
                </button>

                <h2>预览 (<span id="previewCount">0</span>张)</h2>
                <div class="preview-grid" id="previewGrid">
                </div>
            </div>
        </div>
    </div>

    <!-- 进度提示 -->
    <div class="progress-overlay hidden" id="progressOverlay">
        <div class="progress-box">
            <div class="spinner"></div>
            <p id="progressText">正在处理...</p>
        </div>
    </div>

    <!-- 裁剪编辑弹窗 -->
    <div class="modal-overlay hidden" id="cropModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑裁剪区域 <span id="cropModalIndex"></span></h3>
                <button class="modal-close" id="cropModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="crop-canvas-container">
                    <canvas id="cropCanvas"></canvas>
                </div>
                <div class="crop-controls">
                    <div class="crop-info">
                        <span>位置: <span id="cropPosition">0, 0</span></span>
                        <span>尺寸: <span id="cropSize">100 x 100</span></span>
                    </div>
                    <div class="crop-actions">
                        <button class="btn btn-secondary" id="cropReset">重置</button>
                        <button class="btn btn-secondary" id="cropCenter">居中</button>
                        <button class="btn btn-primary" id="cropSave">保存修改</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
